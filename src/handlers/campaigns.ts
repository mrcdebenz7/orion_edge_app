import {supaInsert,sendEmailResend} from '../tools'; export const sendCampaign=async(env:any,args:any)=>{const leads=args.leads||[]; const blocks=['Draft email 1','Draft email 2']; let sent=0; if(args.send){ for(let i=0;i<Math.min(blocks.length,leads.length);i++){const html=`<p>${blocks[i]}</p>`; await sendEmailResend(env,String(leads[i].email),args.subject||'Hi',html); await supaInsert(env,'outbox',{to_email:leads[i].email,subject:args.subject,body_html:html,status:'sent'}); sent++; } } else { for(let i=0;i<Math.min(blocks.length,leads.length);i++){const html=`<p>${blocks[i]}</p>`; await supaInsert(env,'outbox',{to_email:leads[i].email,subject:args.subject,body_html:html,status:'queued'});} } return {ok:true,drafted:blocks.length,sent}; }